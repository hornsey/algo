# Zookeeper应用场景简述

## 概述
Zookeeper是一个分布式协调处理器，具有可扩展性和可靠性等优点，在分布式系统中用途广泛。典型的使用场景如下。

## 配置维护
大型分布式场景中，对相同配置的集群服务器集中进行配置管理，各服务器在zookeeper中注册watcher监听，发布者更新配置后，zookeeper向订阅者推送watcher事件，订阅者收到watcher事件后，从zookeeper拉取最新的配置数据。

## 命名服务
命名服务是为一定范围内的元素命名一个唯一标识，与其他元素进行区分。
该场景通过利用zookeeper中顺序节点自动生成唯一编号的特点来实现。

## DNS服务
DNS即域名系统，将一个特定的名称与一个主机IP和端口绑定起来，写入zookeeper的节点，完成域名到主机的映射。
节点及数据内容的使用，需开发人员自己写代码实现。

## Master选举
zookeeper中多个客户端创建同一节点时，只有一个客户端可以成功创建。利用这一特性，实现Master选举功能。

## 分布式同步
数据复制总线的replicator存在单点问题，需要多个热备主机。此时，就需要zk来完成分布式同步工作。复制总线的工作分为三步：
1) 复制任务注册。在zk中创建replicator总节点，总节点下为复制任务创建一个任务子节点.
2) replicator热备。复制任务是由replicator主机完成，放在复制过程中出现故障，replicator采用热备容灾方案。复制任务部署到多个不同的replicator主机，其中一个处于running状态，其余处于standby状态。running状态的主机故障时，将序号最小的replicator设置为running状态。同时，这些复制任务主机的的状态写入到status子节点，包含running主机对binlog的消费点。
3) 主备切换。当running状态的主机出现宕机时，该主机对应的子节点马上就被删除了，然后处于standby状态序号最小的子节点对应的replicator状态修改为running，完整“主备切换”。

## 集群管理
集群管理就是随时知道集群中各个主机的状态。
实现方式是：在zk上建立一个集群管理节点，每个主机在管理节点下注册一个临时子节点。监控系统通过时刻监控集群管理节点，来了解集群主机的状态。

## 分布式锁
在对资源请求操作时，在锁节点下创建一个读或写临时顺序节点。
**读请求：**若自己是序号最小的的节点，则可以进行读操作；若存在比自己序号小的写请求节点，则向序号小于自己的最后一个写请求节点注册watcher。
**写请求：**若自己是序号最小的的节点，则可以进行写操作；若存在比自己序号小的写请求节点，则向序号小于自己的最后一个写请求节点注册watcher。

## 分布式队列

### FIFO队列
实现原理：利用顺序节点的有序性，为每个数据在zk中创建一个相应的节点。然后为每个节点注册watch监听。一个节点被消费，则会引发消费者消费下一个节点，直到消费完毕。

### Barrier队列
实现原理：在zk中创建一个/barrier节点，其数据内容设置为屏障打开的阈值，即当其下的子节点数量达到该阈值后，应用才可以进行最终的计算，否则一直等待。每一个并行计算完成，都会在/barrier下创建一个子节点，直到所有并行运算完成。











